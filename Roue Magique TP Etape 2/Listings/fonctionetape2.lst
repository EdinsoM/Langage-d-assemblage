


ARM Macro Assembler    Page 1 


    1 00000000         ;*******************************************************
                       ********************
    2 00000000                 THUMB
    3 00000000                 REQUIRE8
    4 00000000                 PRESERVE8
    5 00000000         
    6 00000000         ;*******************************************************
                       *******************
    7 00000000         ; Fichier Vierge.asm
    8 00000000         ; Auteur : V.MAHOUT
    9 00000000         ; Date :  12/11/2013
   10 00000000         ;*******************************************************
                       *******************
   11 00000000         
   12 00000000         ;***************IMPORT/EXPORT***************************
                       *******************
   13 00000000         
   14 00000000         
   15 00000000                 IMPORT           Barrette1
   16 00000000                 IMPORT           Init_Cible
   17 00000000                 EXPORT           DriverGlobal
   18 00000000         ;*******************************************************
                       *******************
   19 00000000         
   20 00000000         
   21 00000000         ;***************CONSTANTES******************************
                       *******************
   22 00000000         
   23 00000000                 include          REG_UTILES.inc
    1 00000000         
    2 00000000         ;**************************************
    3 00000000         ;     Les adresess utiles  
    4 00000000         ;***************************************
    5 00000000         
    6 00000000         
    7 00000000         ;**************************************
    8 00000000         ;     Affectation des bits GPIO  
    9 00000000         ;***************************************
   10 00000000         ; GSLCK..... PA0 
   11 00000000         ; DSPRG..... PA1 
   12 00000000         ; BLANK..... PA2 
   13 00000000         ; XLAT...... PA3
   14 00000000         ; VPRG...... PA4
   15 00000000         ; SCLK...... PA5
   16 00000000         ; SIN1...... PA7
   17 00000000         ;Capteur.....PA8
   18 00000000         
   19 00000000         ;LED.........PB10
   20 00000000         ;****************************************/
   21 00000000         
   22 00000000         
   23 00000000         
   24 00000000 40010800 
                       GPIOBASEA
                               EQU              0X40010800
   25 00000000 40010C00 
                       GPIOBASEB
                               EQU              0X40010C00
   26 00000000         



ARM Macro Assembler    Page 2 


   27 00000000 00000008 
                       OffsetInput
                               EQU              0x08
   28 00000000 0000000C 
                       OffsetOutput
                               EQU              0x0C
   29 00000000 00000010 
                       OffsetSet
                               EQU              0x10
   30 00000000 00000014 
                       OffsetReset
                               EQU              0x14
   31 00000000         
   32 00000000         
   33 00000000 00000080 
                       MaskSerial_In1
                               equ              0x80
   34 00000000 00000080 
                       MaskSerial_Dots
                               equ              0x80
   35 00000000 00000010 
                       MaskVprg
                               equ              0x10
   36 00000000 00000008 
                       MaskXlat
                               equ              0x08
   37 00000000 00000004 
                       MaskBlank
                               equ              0x04
   38 00000000 00000020 
                       MaskSclk
                               equ              0x20
   39 00000000 00000002 
                       MaskDsprg
                               equ              0x02
   40 00000000 00000001 
                       MaskGsclk
                               equ              0x01
   41 00000000         
   42 00000000         
   43 00000000 E000ED08 
                       SCB_VTOR
                               EQU              0xE000ED08
   44 00000000 40012C10 
                       TIM1_SR EQU              0x40012c10
   45 00000000 40012C24 
                       TIM1_CNT
                               EQU              0x40012c24
   46 00000000 4000082C 
                       TIM4_ARR
                               EQU              0x4000082C
   47 00000000 40000810 
                       TIM4_SR EQU              0x40000810
   48 00000000         
   49 00000000         
   50 00000000         
   51 00000000         
   52 00000000         
   53 00000000                 END



ARM Macro Assembler    Page 3 


   24 00000000         
   25 00000000         ;*******************************************************
                       *******************
   26 00000000         
   27 00000000         
   28 00000000         ;***************VARIABLES*******************************
                       *******************
   29 00000000                 AREA             MesDonnees, data, readwrite
   30 00000000         ;*******************************************************
                       *******************
   31 00000000         
   32 00000000         
   33 00000000         
   34 00000000         ;*******************************************************
                       *******************
   35 00000000         
   36 00000000         
   37 00000000         
   38 00000000         ;***************CODE************************************
                       *******************
   39 00000000                 AREA             moncode, code, readonly
   40 00000000         ;*******************************************************
                       *******************
   41 00000000         
   42 00000000 F04F 0001       MOV              R0,#1
   43 00000004 F7FF FFFE       BL               Init_Cible  ;
   44 00000008         
   45 00000008         DriverGlobal
                               PROC
   46 00000008         
   47 00000008 E92D 0102       PUSH             {R1,R8}
   48 0000000C F7FF FFFE       BL               SetSCLK
   49 00000010 F04F 0100       MOV              R1, #0      ;NbLED
   50 00000014         Pour
   51 00000014 292F            CMP              R1, #47
   52 00000016 D100            BNE              FairePour
   53 00000018 E028            B                Semaphore
   54 0000001A         
   55 0000001A         FairePour
   56 0000001A 4A1B            LDR              R2,=Barrette1
   57 0000001C 5C53            LDRB             R3,[R2,R1]
   58 0000001E EA4F 6303       LSL              R3, R3, #24
   59 00000022         
   60 00000022 F04F 0400       MOV              R4, #0      ;NbBit
   61 00000026         AutrePour
   62 00000026 2C0B            CMP              R4, #11
   63 00000028 D1FF            BNE              FaireAutrePour
   64 0000002A         
   65 0000002A         FaireAutrePour
   66 0000002A         
   67 0000002A F7FF FFFE       BL               ResetSCLK
   68 0000002E         
   69 0000002E F003 4600       AND              R6, R3, #0x80000000
   70 00000032 F1B6 4F00       CMP              R6, #0x80000000
   71 00000036 D000            BEQ              SetSin      ;commence le si (if
                                                            )
   72 00000038 E005            B                ResetSin
   73 0000003A         
   74 0000003A         SetSin



ARM Macro Assembler    Page 4 


   75 0000003A 4F14            LDR              R7, =0X40010810
   76 0000003C F04F 0880       MOV              R8, #(0x01<<7)
   77 00000040 F887 8000       STRB             R8, [R7]
   78 00000044 E008            B                AvantFinir
   79 00000046         
   80 00000046         ResetSin
   81 00000046 4F12            LDR              R7, =0x40010814
   82 00000048 F04F 0880       MOV              R8, #(0x01<<7)
   83 0000004C F887 8000       STRB             R8, [R7]
   84 00000050         ;le si est fini
   85 00000050         
   86 00000050 EA4F 0343       LSL              R3, R3, #1
   87 00000054         
   88 00000054 F7FF FFFE       BL               SetSCLK
   89 00000058         
   90 00000058         AvantFinir                           ;Sont finis les deu
                                                            x boucles? On verra
                                                            
   91 00000058         
   92 00000058 F104 0401       ADD              R4, R4, #1  ;NbBit+1
   93 0000005C 2C0B            CMP              R4, #11
   94 0000005E D1E2            BNE              AutrePour
   95 00000060         
   96 00000060 F101 0101       ADD              R1, R1, #1  ;NbLed+1
   97 00000064 292F            CMP              R1, #47
   98 00000066 D1D5            BNE              Pour
   99 00000068         
  100 00000068 E8BD 0102       POP              {R1,R8}
  101 0000006C         
  102 0000006C         ;Les deux boucles sont finis
  103 0000006C         
  104 0000006C         Semaphore
  105 0000006C F04F 0100       MOV              R1, #0      ;DataSend = 0
  106 00000070 4770            BX               LR
  107 00000072                 ENDP
  108 00000072         
  109 00000072         SetSCLK PROC
  110 00000072 4A06            LDR              R2, = GPIOBASEA + OffsetSet
  111 00000074 F04F 0120       MOV              R1, #(0x01<<5)
  112 00000078 7011            STRB             R1, [R2]
  113 0000007A 4770            BX               LR
  114 0000007C         
  115 0000007C                 ENDP
  116 0000007C         
  117 0000007C         ResetSCLK
                               PROC
  118 0000007C 4D04            LDR              R5, = GPIOBASEA + OffsetReset 
                                                            ; Reset(SCLK) 
  119 0000007E F04F 0620       MOV              R6, #(0x01<<5)
  120 00000082 702E            STRB             R6, [R5]
  121 00000084 4770            BX               LR
  122 00000086         
  123 00000086                 ENDP
  124 00000086         
  125 00000086         
  126 00000086         ;#######################################################
                       #################
  127 00000086         ; Procédure ????
  128 00000086         ;#######################################################



ARM Macro Assembler    Page 5 


                       #################
  129 00000086         ;
  130 00000086         ; Paramètre entrant  : ???
  131 00000086         ; Paramètre sortant  : ???
  132 00000086         ; Variables globales : ???
  133 00000086         ; Registres modifiés : ???
  134 00000086         ;-------------------------------------------------------
                       -----------------
  135 00000086         
  136 00000086         
  137 00000086         
  138 00000086         
  139 00000086         
  140 00000086         
  141 00000086         ;*******************************************************
                       *******************
  142 00000086                 END
              00 00 00000000 
              40010810 
              40010814 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M3 --apcs=interw
ork --depend=.\objects\fonctionetape2.d -o.\objects\fonctionetape2.o -I.\RTE\De
vice\STM32F103RB -I.\RTE\_Simul_ -IC:\Users\emarina\AppData\Local\Arm\Packs\ARM
\CMSIS\5.6.0\CMSIS\Core\Include -IC:\Users\emarina\AppData\Local\Arm\Packs\Keil
\STM32F1xx_DFP\2.3.0\Device\Include --predefine="__EVAL SETA 1" --predefine="__
MICROLIB SETA 1" --predefine="__UVISION_VERSION SETA 529" --predefine="_RTE_ SE
TA 1" --predefine="STM32F10X_MD SETA 1" --predefine="STM32F10X_MD SETA 1" --lis
t=.\listings\fonctionetape2.lst FonctionEtape2.asm



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

MesDonnees 00000000

Symbol: MesDonnees
   Definitions
      At line 29 in file FonctionEtape2.asm
   Uses
      None
Comment: MesDonnees unused
1 symbol



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

AutrePour 00000026

Symbol: AutrePour
   Definitions
      At line 61 in file FonctionEtape2.asm
   Uses
      At line 94 in file FonctionEtape2.asm
Comment: AutrePour used once
AvantFinir 00000058

Symbol: AvantFinir
   Definitions
      At line 90 in file FonctionEtape2.asm
   Uses
      At line 78 in file FonctionEtape2.asm
Comment: AvantFinir used once
DriverGlobal 00000008

Symbol: DriverGlobal
   Definitions
      At line 45 in file FonctionEtape2.asm
   Uses
      At line 17 in file FonctionEtape2.asm
Comment: DriverGlobal used once
FaireAutrePour 0000002A

Symbol: FaireAutrePour
   Definitions
      At line 65 in file FonctionEtape2.asm
   Uses
      At line 63 in file FonctionEtape2.asm
Comment: FaireAutrePour used once
FairePour 0000001A

Symbol: FairePour
   Definitions
      At line 55 in file FonctionEtape2.asm
   Uses
      At line 52 in file FonctionEtape2.asm
Comment: FairePour used once
Pour 00000014

Symbol: Pour
   Definitions
      At line 50 in file FonctionEtape2.asm
   Uses
      At line 98 in file FonctionEtape2.asm
Comment: Pour used once
ResetSCLK 0000007C

Symbol: ResetSCLK
   Definitions
      At line 117 in file FonctionEtape2.asm
   Uses
      At line 67 in file FonctionEtape2.asm
Comment: ResetSCLK used once
ResetSin 00000046

Symbol: ResetSin



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 80 in file FonctionEtape2.asm
   Uses
      At line 72 in file FonctionEtape2.asm
Comment: ResetSin used once
Semaphore 0000006C

Symbol: Semaphore
   Definitions
      At line 104 in file FonctionEtape2.asm
   Uses
      At line 53 in file FonctionEtape2.asm
Comment: Semaphore used once
SetSCLK 00000072

Symbol: SetSCLK
   Definitions
      At line 109 in file FonctionEtape2.asm
   Uses
      At line 48 in file FonctionEtape2.asm
      At line 88 in file FonctionEtape2.asm

SetSin 0000003A

Symbol: SetSin
   Definitions
      At line 74 in file FonctionEtape2.asm
   Uses
      At line 71 in file FonctionEtape2.asm
Comment: SetSin used once
moncode 00000000

Symbol: moncode
   Definitions
      At line 39 in file FonctionEtape2.asm
   Uses
      None
Comment: moncode unused
12 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

GPIOBASEA 40010800

Symbol: GPIOBASEA
   Definitions
      At line 24 in file REG_UTILES.inc
   Uses
      At line 110 in file FonctionEtape2.asm
      At line 118 in file FonctionEtape2.asm

GPIOBASEB 40010C00

Symbol: GPIOBASEB
   Definitions
      At line 25 in file REG_UTILES.inc
   Uses
      None
Comment: GPIOBASEB unused
MaskBlank 00000004

Symbol: MaskBlank
   Definitions
      At line 37 in file REG_UTILES.inc
   Uses
      None
Comment: MaskBlank unused
MaskDsprg 00000002

Symbol: MaskDsprg
   Definitions
      At line 39 in file REG_UTILES.inc
   Uses
      None
Comment: MaskDsprg unused
MaskGsclk 00000001

Symbol: MaskGsclk
   Definitions
      At line 40 in file REG_UTILES.inc
   Uses
      None
Comment: MaskGsclk unused
MaskSclk 00000020

Symbol: MaskSclk
   Definitions
      At line 38 in file REG_UTILES.inc
   Uses
      None
Comment: MaskSclk unused
MaskSerial_Dots 00000080

Symbol: MaskSerial_Dots
   Definitions
      At line 34 in file REG_UTILES.inc
   Uses
      None
Comment: MaskSerial_Dots unused
MaskSerial_In1 00000080




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

Symbol: MaskSerial_In1
   Definitions
      At line 33 in file REG_UTILES.inc
   Uses
      None
Comment: MaskSerial_In1 unused
MaskVprg 00000010

Symbol: MaskVprg
   Definitions
      At line 35 in file REG_UTILES.inc
   Uses
      None
Comment: MaskVprg unused
MaskXlat 00000008

Symbol: MaskXlat
   Definitions
      At line 36 in file REG_UTILES.inc
   Uses
      None
Comment: MaskXlat unused
OffsetInput 00000008

Symbol: OffsetInput
   Definitions
      At line 27 in file REG_UTILES.inc
   Uses
      None
Comment: OffsetInput unused
OffsetOutput 0000000C

Symbol: OffsetOutput
   Definitions
      At line 28 in file REG_UTILES.inc
   Uses
      None
Comment: OffsetOutput unused
OffsetReset 00000014

Symbol: OffsetReset
   Definitions
      At line 30 in file REG_UTILES.inc
   Uses
      At line 118 in file FonctionEtape2.asm
Comment: OffsetReset used once
OffsetSet 00000010

Symbol: OffsetSet
   Definitions
      At line 29 in file REG_UTILES.inc
   Uses
      At line 110 in file FonctionEtape2.asm
Comment: OffsetSet used once
SCB_VTOR E000ED08

Symbol: SCB_VTOR
   Definitions
      At line 43 in file REG_UTILES.inc



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Absolute symbols

   Uses
      None
Comment: SCB_VTOR unused
TIM1_CNT 40012C24

Symbol: TIM1_CNT
   Definitions
      At line 45 in file REG_UTILES.inc
   Uses
      None
Comment: TIM1_CNT unused
TIM1_SR 40012C10

Symbol: TIM1_SR
   Definitions
      At line 44 in file REG_UTILES.inc
   Uses
      None
Comment: TIM1_SR unused
TIM4_ARR 4000082C

Symbol: TIM4_ARR
   Definitions
      At line 46 in file REG_UTILES.inc
   Uses
      None
Comment: TIM4_ARR unused
TIM4_SR 40000810

Symbol: TIM4_SR
   Definitions
      At line 47 in file REG_UTILES.inc
   Uses
      None
Comment: TIM4_SR unused
19 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

Barrette1 00000000

Symbol: Barrette1
   Definitions
      At line 15 in file FonctionEtape2.asm
   Uses
      At line 56 in file FonctionEtape2.asm
Comment: Barrette1 used once
Init_Cible 00000000

Symbol: Init_Cible
   Definitions
      At line 16 in file FonctionEtape2.asm
   Uses
      At line 43 in file FonctionEtape2.asm
Comment: Init_Cible used once
2 symbols
371 symbols in table
